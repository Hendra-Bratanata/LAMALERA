<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- Version: 5.0 - Simplified display-only version (calculations moved to Python) -->
<title>Lamalera</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a14 0%, #1a1a2e 50%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #e74c3c, #f39c12, #3498db);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }
        .stock-selector {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .stock-selector label {
            font-size: 1.1rem;
            color: #888;
        }
        .stock-selector select {
            padding: 10px 20px;
            font-size: 1rem;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            min-width: 200px;
        }
        .stock-selector select:hover {
            background: rgba(255,255,255,0.15);
        }
        .stock-selector select option {
            background: #1a1a2e;
            color: #fff;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        .stat-card.whale {
            border-top: 3px solid #e74c3c;
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(255,255,255,0.05));
        }
        .stat-card.retail {
            border-top: 3px solid #3498db;
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(255,255,255,0.05));
        }
        .stat-card h3 {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .stat-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .stat-card .value.positive {
            color: #27ae60;
        }
        .stat-card .value.negative {
            color: #e74c3c;
        }
        .stat-card .subtext {
            font-size: 0.8rem;
            color: #666;
        }
        .recommendation-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .recommendation-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 25px;
        }
        .recommendation-card h3 {
            font-size: 1rem;
            color: #888;
            margin-bottom: 15px;
            text-transform: uppercase;
        }
        .rec-badge {
            display: inline-block;
            padding: 8px 25px;
            border-radius: 25px;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
        }
        .rec-badge.BUY {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }
        .rec-badge.SELL {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }
        .rec-badge.HOLD {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
        }
        .rec-reason {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #aaa;
            margin-bottom: 15px;
        }
        .rec-signals {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .signal-item {
            background: rgba(255,255,255,0.03);
            padding: 10px;
            border-radius: 8px;
        }
        .signal-label {
            display: block;
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 5px;
        }
        .signal-value {
            display: block;
            font-size: 0.95rem;
            font-weight: 600;
        }
        .signal-value.bullish {
            color: #27ae60;
        }
        .signal-value.bearish {
            color: #e74c3c;
        }
        .signal-value.neutral {
            color: #f39c12;
        }
        .price-rec-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 25px;
        }
        .price-rec-card h3 {
            font-size: 1rem;
            color: #888;
            margin-bottom: 15px;
            text-transform: uppercase;
        }
        .price-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }
        .price-item {
            background: rgba(255,255,255,0.03);
            padding: 15px 10px;
            border-radius: 10px;
            text-align: center;
        }
        .price-item.buy-zone {
            border: 2px solid #27ae60;
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(255,255,255,0.03));
        }
        .price-item.target {
            border: 2px solid #f39c12;
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.1), rgba(255,255,255,0.03));
        }
        .price-item.sell-zone {
            border: 2px solid #e74c3c;
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(255,255,255,0.03));
        }
        .price-item.stoploss {
            border: 2px solid #9b59b6;
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(255,255,255,0.03));
        }
        .price-label {
            display: block;
            font-size: 0.75rem;
            color: #888;
            font-weight: bold;
            text-transform: uppercase;
        }
        .price-label-sub {
            display: block;
            font-size: 0.65rem;
            color: #666;
            margin-bottom: 5px;
        }
        .price-value {
            display: block;
            font-size: 1.1rem;
            font-weight: bold;
            color: #fff;
        }
        .price-info {
            background: rgba(255,255,255,0.03);
            padding: 15px;
            border-radius: 10px;
        }
        .price-advice-text {
            font-size: 0.85rem;
            line-height: 1.6;
            color: #aaa;
        }
        .trapped-whale-warning {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.15), rgba(192, 57, 43, 0.1));
            border: 2px solid rgba(231, 76, 60, 0.4);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }
        .trapped-whale-warning h4 {
            color: #e74c3c;
            font-size: 1rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .trapped-whale-warning p {
            color: #aaa;
            font-size: 0.85rem;
            line-height: 1.5;
            margin: 0;
        }
        .trapped-whale-warning .highlight {
            color: #e74c3c;
            font-weight: bold;
        }
        .trapped-whale-card {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.12), rgba(192, 57, 43, 0.08));
            border: 2px solid rgba(231, 76, 60, 0.35);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        .trapped-whale-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #e74c3c, #c0392b, #e74c3c);
            animation: pulse-border 2s ease-in-out infinite;
        }
        @keyframes pulse-border {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .trapped-whale-card .status-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(231, 76, 60, 0.2);
        }
        .trapped-whale-card .status-icon {
            font-size: 1.8rem;
        }
        .trapped-whale-card .status-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #e74c3c;
        }
        .trapped-whale-card .status-badge {
            background: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        .trapped-whale-card .status-body {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .trapped-whale-card .status-item {
            background: rgba(255,255,255,0.03);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .trapped-whale-card .status-label {
            font-size: 0.7rem;
            color: #888;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        .trapped-whale-card .status-value {
            font-size: 1rem;
            font-weight: bold;
            color: #e74c3c;
        }
        .trapped-whale-card .status-value.neutral {
            color: #f39c12;
        }
        .trapped-whale-card .status-description {
            grid-column: 1 / -1;
            background: rgba(231, 76, 60, 0.1);
            padding: 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            color: #aaa;
            line-height: 1.5;
            border-left: 3px solid #e74c3c;
        }
        .trapped-whale-card .status-description strong {
            color: #e74c3c;
        }
        .trapped-alert-card {
            background: rgba(231, 76, 60, 0.08);
            border: 1px solid rgba(231, 76, 60, 0.25);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .trapped-alert-card:hover {
            transform: translateY(-3px);
            border-color: rgba(231, 76, 60, 0.5);
            box-shadow: 0 5px 20px rgba(231, 76, 60, 0.2);
        }
        .trapped-alert-card.severe {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.15), rgba(192, 57, 43, 0.08));
            border-color: rgba(231, 76, 60, 0.4);
        }
        .trapped-alert-card.mild {
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.12), rgba(230, 126, 34, 0.06));
            border-color: rgba(243, 156, 18, 0.35);
        }
        .trapped-alert-card .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .trapped-alert-card .stock-code {
            font-size: 1.3rem;
            font-weight: bold;
            color: #e74c3c;
        }
        .trapped-alert-card .stock-code.mild {
            color: #f39c12;
        }
        .trapped-alert-card .trap-badge {
            background: rgba(231, 76, 60, 0.25);
            color: #e74c3c;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        .trapped-alert-card .trap-badge.mild {
            background: rgba(243, 156, 18, 0.25);
            color: #f39c12;
        }
        .trapped-alert-card .card-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        .trapped-alert-card .info-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .trapped-alert-card .info-label {
            font-size: 0.75rem;
            color: #888;
        }
        .trapped-alert-card .info-value {
            font-size: 0.85rem;
            font-weight: 600;
            color: #e74c3c;
        }
        .trapped-alert-card .info-value.mild {
            color: #f39c12;
        }
        .trapped-alert-card .info-arrow {
            color: #27ae60;
        }
        .chart-section {
            margin-bottom: 30px;
        }
        .chart-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .stock-title {
            color: #27ae60;
            font-size: 1.2rem;
        }
        .chart-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        .chart-section .chart-header-row {
            grid-column: 1 / -1;
        }
        .chart-container {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
        }
        .chart-container.full-width {
            grid-column: 1 / -1;
        }
        .chart-container h2 {
            font-size: 1rem;
            color: #888;
            margin-bottom: 15px;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
            justify-content: center;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: #888;
        }
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }
        .chart-wrapper {
            position: relative;
            height: 280px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .chart-wrapper canvas {
            max-height: 100%;
            max-width: 100%;
        }
        .chart-wrapper.tall {
            height: 350px;
        }
        .chart-description {
            font-size: 0.8rem;
            color: #777;
            line-height: 1.5;
            margin-top: 15px;
            padding: 12px;
            background: rgba(255,255,255,0.02);
            border-radius: 8px;
            border-left: 3px solid #3498db;
        }
        .chart-description strong {
            color: #999;
        }
        .chart-description em {
            color: #666;
            font-style: italic;
        }
        .insight-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .insight-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
        }
        .insight-card h3 {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 12px;
            text-transform: uppercase;
        }
        .insight-card p {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #aaa;
        }
        .insight-card .highlight {
            color: #27ae60;
            font-weight: bold;
        }
        .legend-panel {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
        }
        .legend-panel .legend-item {
            display: block;
            background: rgba(255,255,255,0.04);
            padding: 18px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .legend-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .legend-header.whale {
            color: #e74c3c;
        }
        .legend-header.retail {
            color: #3498db;
        }
        .legend-icon {
            font-size: 1.6rem;
        }
        .legend-title {
            font-weight: bold;
            font-size: 0.95rem;
        }
        .legend-body {
            font-size: 0.85rem;
        }
        .legend-desc {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
            padding: 10px;
            background: rgba(255,255,255,0.02);
            border-radius: 6px;
        }
        .legend-desc:last-child {
            margin-bottom: 0;
        }
        .legend-text {
            color: #999;
            line-height: 1.5;
        }
        .signal-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
            white-space: nowrap;
            flex-shrink: 0;
        }
        .signal-badge.bullish {
            background: rgba(39, 174, 96, 0.25);
            color: #27ae60;
            border: 1px solid rgba(39, 174, 96, 0.3);
        }
        .signal-badge.bearish {
            background: rgba(231, 76, 60, 0.25);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }
        .signal-badge.neutral {
            background: rgba(243, 156, 18, 0.25);
            color: #f39c12;
            border: 1px solid rgba(243, 156, 18, 0.3);
        }
        .legend-item.full-width {
            grid-column: 1 / -1;
        }
        .logic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        .logic-item {
            background: rgba(255,255,255,0.04);
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid #f39c12;
        }
        .logic-phase {
            display: block;
            font-weight: bold;
            color: #f39c12;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }
        .logic-desc {
            font-size: 0.85rem;
            color: #999;
            line-height: 1.5;
        }
        .legend-note {
            background: rgba(243, 156, 18, 0.15);
            padding: 15px;
            border-radius: 10px;
            font-size: 0.8rem;
            color: #f39c12;
            border-left: 3px solid #f39c12;
            line-height: 1.6;
        }
        .broker-table {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            overflow-x: auto;
        }
        .table-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .table-controls h3 {
            color: #888;
            font-size: 1rem;
        }
        .filter-group {
            display: flex;
            gap: 10px;
        }
        .filter-btn {
            padding: 8px 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .filter-btn:hover {
            background: rgba(255,255,255,0.1);
        }
        .filter-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        th {
            background: rgba(255,255,255,0.1);
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            color: #888;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        tr:hover {
            background: rgba(255,255,255,0.03);
        }
        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        .badge.whale {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }
        .badge.retail {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
        }
        .positive {
            color: #27ae60;
        }
        .negative {
            color: #e74c3c;
        }
        .error-message {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid #e74c3c;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }
        #loadingMessage {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid #3498db;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
        }
        #loadingMessage p {
            font-size: 1.1rem;
            margin: 0;
        }
        .file-input-area {
            text-align: center;
            padding: 30px;
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            margin: 20px 0;
        }
        .file-input-area input {
            margin: 10px;
        }
        .file-input-area button {
            padding: 10px 20px;
            background: #3498db;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
        }
        /* Stock Recommendation Card Styles */
        .stock-rec-card {
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(46, 204, 113, 0.05));
            border-radius: 12px;
            padding: 20px;
            border: 2px solid rgba(39, 174, 96, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .stock-rec-card:hover {
            transform: translateY(-5px);
            border-color: rgba(39, 174, 96, 0.6);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
        }
        .stock-rec-card.selected {
            border-color: #27ae60;
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.2), rgba(46, 204, 113, 0.1));
        }
        .stock-rec-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .stock-rec-code {
            font-size: 1.8rem;
            font-weight: bold;
            color: #27ae60;
        }
        .stock-rec-badge {
            background: #27ae60;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .stock-rec-badge.strong {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }
        .stock-rec-badge.moderate {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        .stock-rec-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        .stock-rec-info-item {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        .stock-rec-info-label {
            font-size: 0.7rem;
            color: #888;
            margin-bottom: 5px;
        }
        .stock-rec-info-value {
            font-size: 1rem;
            font-weight: 600;
            color: #fff;
        }
        .stock-rec-info-value.positive { color: #27ae60; }
        .stock-rec-info-value.negative { color: #e74c3c; }
        .stock-rec-reason {
            font-size: 0.8rem;
            color: #aaa;
            line-height: 1.4;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .stock-rec-confidence {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 10px;
        }
        .stock-rec-confidence.high { background: rgba(39, 174, 96, 0.3); color: #27ae60; }
        .stock-rec-confidence.medium { background: rgba(243, 156, 18, 0.3); color: #f39c12; }
        .stock-rec-confidence.low { background: rgba(231, 76, 60, 0.3); color: #e74c3c; }
        /* ============================================
           RESPONSIVE DESIGN - MOBILE FIRST
           ============================================ */

        /* Extra Small Devices (phones, < 480px) */
        @media (max-width: 479px) {
            .container { padding: 10px; }
            .header { padding: 15px 0; margin-bottom: 15px; }
            .header h1 { font-size: 1.5rem; margin-bottom: 8px; }
            .header p { font-size: 0.75rem; }
            .stock-selector { gap: 10px; margin-bottom: 15px; }
            .stock-selector label { font-size: 0.9rem; }
            .stock-selector select {
                min-width: 100%;
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
                margin-bottom: 15px;
            }
            .stat-card { padding: 12px 8px; }
            .stat-card h3 { font-size: 0.7rem; }
            .stat-card .value { font-size: 1.1rem; }
            .stat-card .subtext { font-size: 0.65rem; }
            .recommendation-panel {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-bottom: 15px;
            }
            .recommendation-card, .price-rec-card { padding: 15px; }
            .rec-badge { font-size: 1.2rem; padding: 6px 20px; }
            .price-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            .price-item { padding: 10px 5px; }
            .price-label { font-size: 0.65rem; }
            .price-label-sub { font-size: 0.55rem; }
            .price-value { font-size: 0.9rem; }
            .rec-signals { grid-template-columns: 1fr; gap: 8px; }
            .signal-item { padding: 8px; }
            .signal-label { font-size: 0.7rem; }
            .signal-value { font-size: 0.85rem; }
            .price-advice-text { font-size: 0.75rem; }
            .chart-section {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-bottom: 15px;
            }
            .chart-header-row { flex-direction: column; align-items: flex-start; }
            .chart-container { padding: 12px; }
            .chart-container h2 { font-size: 0.85rem; }
            .chart-wrapper { height: 220px; }
            .chart-wrapper.tall { height: 280px; }
            .chart-description { font-size: 0.7rem; padding: 10px; margin-top: 10px; }
            .legend { gap: 10px; }
            .legend-item { font-size: 0.7rem; }
            .legend-color { width: 12px; height: 12px; }
            .insight-panel {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-bottom: 15px;
            }
            .insight-card { padding: 15px; }
            .insight-card h3 { font-size: 0.8rem; }
            .insight-card p { font-size: 0.8rem; }
            .legend-panel { padding: 15px; margin-bottom: 15px; }
            .legend-grid { grid-template-columns: 1fr; gap: 12px; }
            .legend-item { padding: 12px; }
            .legend-header { font-size: 0.85rem; }
            .legend-icon { font-size: 1.3rem; }
            .legend-title { font-size: 0.85rem; }
            .legend-body { font-size: 0.75rem; }
            .legend-desc { padding: 8px; margin-bottom: 8px; }
            .legend-text { font-size: 0.75rem; line-height: 1.4; }
            .signal-badge { font-size: 0.6rem; padding: 3px 8px; }
            .logic-grid { grid-template-columns: 1fr; gap: 10px; }
            .logic-item { padding: 12px; }
            .logic-phase { font-size: 0.75rem; }
            .logic-desc { font-size: 0.75rem; }
            .legend-note { padding: 12px; font-size: 0.7rem; line-height: 1.5; }
            .broker-table { padding: 12px; margin-bottom: 15px; }
            .table-controls { flex-direction: column; align-items: stretch; gap: 10px; }
            .table-controls h3 { font-size: 0.9rem; text-align: center; }
            .filter-group { justify-content: center; }
            .filter-btn { padding: 6px 12px; font-size: 0.8rem; }
            table { font-size: 0.7rem; }
            th, td { padding: 8px 4px; }
            .badge { font-size: 0.6rem; padding: 2px 6px; }
            #loadingMessage { padding: 20px 15px; }
            #loadingMessage p { font-size: 0.9rem; }
            .file-input-area { padding: 15px; }
            .file-input-area button { padding: 8px 15px; font-size: 0.85rem; }
            #recommendationsList {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            .stock-rec-card { padding: 15px; }
            .stock-rec-header { flex-direction: column; align-items: flex-start; gap: 8px; }
            .stock-rec-code { font-size: 1.4rem; }
            .stock-rec-badge { align-self: flex-start; }
            .stock-rec-info { grid-template-columns: 1fr 1fr; gap: 8px; }
            .stock-rec-info-label { font-size: 0.65rem; }
            .stock-rec-info-value { font-size: 0.9rem; }
            .stock-rec-reason { font-size: 0.75rem; padding-top: 8px; }
            .stock-rec-confidence { font-size: 0.6rem; padding: 2px 6px; }
            .trapped-whale-warning { padding: 12px; }
            .trapped-whale-card { padding: 12px; }
            .trapped-whale-card .status-body { grid-template-columns: 1fr; gap: 8px; }
            .trapped-whale-card .status-icon { font-size: 1.3rem; }
            .trapped-whale-card .status-title { font-size: 0.9rem; }
            .trapped-whale-card .status-badge { font-size: 0.6rem; }
            .trapped-whale-card .status-item { padding: 8px; }
            .trapped-whale-card .status-label { font-size: 0.6rem; }
            .trapped-whale-card .status-value { font-size: 0.85rem; }
            .trapped-whale-card .status-description { font-size: 0.7rem; }
        }
            .trapped-whale-warning h4 { font-size: 0.9rem; }
            .trapped-whale-warning p { font-size: 0.75rem; }
            .trapped-whale-card { padding: 15px; margin-bottom: 15px; }
            .trapped-whale-card .status-header { flex-wrap: wrap; }
            .trapped-whale-card .status-icon { font-size: 1.5rem; }
            .trapped-whale-card .status-title { font-size: 1rem; }
            .trapped-whale-card .status-badge { font-size: 0.65rem; }
            .trapped-whale-card .status-body { grid-template-columns: 1fr 1fr; gap: 10px; }
            .trapped-whale-card .status-item { padding: 10px; }
            .trapped-whale-card .status-label { font-size: 0.65rem; }
            .trapped-whale-card .status-value { font-size: 0.9rem; }
            .trapped-whale-card .status-description { font-size: 0.75rem; padding: 10px; }
            #trappedWhaleList { grid-template-columns: 1fr; gap: 10px; }
            .trapped-alert-card { padding: 12px; }
            .trapped-alert-card .stock-code { font-size: 1.2rem; }
            .trapped-alert-card .card-body { grid-template-columns: 1fr 1fr; gap: 6px; }
            .trapped-alert-card .info-label { font-size: 0.7rem; }
            .trapped-alert-card .info-value { font-size: 0.8rem; }
        }

        /* Small Devices (landscape phones, 480px - 640px) */
        @media (min-width: 480px) and (max-width: 639px) {
            .container { padding: 15px; }
            .header h1 { font-size: 1.8rem; }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            .stat-card { padding: 15px 10px; }
            .recommendation-panel {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            .price-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
            }
            .chart-section {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            .chart-wrapper { height: 240px; }
            .insight-panel { grid-template-columns: 1fr; }
            .legend-grid { grid-template-columns: 1fr; gap: 15px; }
            .broker-table { padding: 15px; }
            #recommendationsList {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
        }

        /* Medium Devices (tablets, 640px - 768px) */
        @media (min-width: 640px) and (max-width: 768px) {
            .container { padding: 15px; }
            .header h1 { font-size: 2rem; }
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            .recommendation-panel {
                grid-template-columns: 1fr 1fr;
            }
            .price-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            .chart-section {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            .insight-panel { grid-template-columns: 1fr; }
            .legend-grid { grid-template-columns: 1fr 1fr; }
            #recommendationsList {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Large Devices (tablets landscape, 768px - 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container { max-width: 1024px; padding: 20px; }
            .header h1 { font-size: 2.2rem; }
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            .chart-section {
                grid-template-columns: repeat(2, 1fr);
            }
            .legend-grid { grid-template-columns: repeat(2, 1fr); }
            #recommendationsList {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Extra Large Devices (desktops, > 1024px) */
        @media (min-width: 1025px) {
            .container { max-width: 1600px; }
        }

        /* Dark mode adjustments for mobile */
        @media (prefers-color-scheme: dark) and (max-width: 768px) {
            body { background: linear-gradient(135deg, #080810 0%, #12121f 50%, #0f1626 100%); }
        }

        /* Touch-friendly interactive elements */
        @media (hover: none) and (pointer: coarse) {
            .filter-btn, .stock-selector select, .stock-rec-card {
                min-height: 44px;
                min-width: 44px;
            }
            .stat-card:hover, .stock-rec-card:hover {
                transform: none;
            }
            .stat-card:active, .stock-rec-card:active {
                transform: scale(0.98);
            }
            table { font-size: 0.8rem; }
            th, td { padding: 12px 6px; }
        }

        /* Smooth scrolling for mobile */
        @media (max-width: 768px) {
            html { scroll-behavior: smooth; }
            body { -webkit-overflow-scrolling: touch; }
            .broker-table {
                -webkit-overflow-scrolling: touch;
                overflow-x: auto;
            }
        }

        /* Hide scrollbars but keep functionality */
        .broker-table::-webkit-scrollbar {
            height: 4px;
        }
        .broker-table::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
        }

        /* Mobile-specific adjustments for text */
        @media (max-width: 479px) {
            .price-advice-text, .chart-description, .legend-text {
                text-align: justify;
                hyphens: auto;
                -webkit-hyphens: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêã Lamalera</h1>
            <p style="color: #888; font-size: 0.9rem; margin-top: 5px;">Whale Trading Analysis Dashboard</p>
        </div>
        <!-- Period Info -->
        <div id="periodInfo" style="display: none; text-align: center; margin-bottom: 30px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);">
            <h3 style="color: #888; font-size: 0.9rem; margin-bottom: 10px;">PERIODE DATA</h3>
            <p id="periodText" style="font-size: 1.2rem; font-weight: bold;">-</p>
        </div>
        <!-- Loading Message -->
        <div id="loadingMessage" style="text-align: center; padding: 30px; color: #888;">
            <p id="loadingText">Memuat data broker_data.json...</p>
            <p style="font-size: 0.9rem; margin-top: 10px; color: #666;">
                Jika data tidak termuat, pastikan file ada atau gunakan local server.<br>
                <strong>Tip:</strong> Jalankan <code>python -m http.server 8000</code> di folder ini, lalu buka <a href="http://localhost:8000/dashboard.html" target="_blank">http://localhost:8000/dashboard.html</a>
            </p>
            <div style="margin-top: 20px;">
                <label style="cursor: pointer; background: rgba(52, 152, 219, 0.2); padding: 10px 20px; border-radius: 5px; color: #3498db;">
                    <input type="file" id="fallbackFileInput" accept=".json" style="display: none;" onchange="loadFromFile(this)">
                    üìÅ Pilih file broker_data.json manual
                </label>
            </div>
        </div>
        <!-- Error Message -->
        <div id="errorMessage" class="error-message" style="display: none;"></div>

        <!-- Trapped Whale Alert Section -->
        <div id="trappedWhaleAlertSection" style="display: none; margin-bottom: 30px;">
            <div style="background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(192, 57, 43, 0.05)); border: 2px solid rgba(231, 76, 60, 0.3); border-radius: 12px; padding: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                    <h2 style="color: #e74c3c; font-size: 1.1rem; margin: 0;">‚ö†Ô∏è WHALE TERJEBAK - PERLU PERHATIAN</h2>
                    <span id="trappedCount" class="badge" style="background: rgba(231, 76, 60, 0.3); color: #e74c3c; font-size: 0.8rem;">0 saham</span>
                </div>
                <div id="trappedWhaleList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px;">
                    <!-- Trapped whale cards will be injected here -->
                </div>
                <p style="margin-top: 15px; font-size: 0.8rem; color: #888; text-align: center;">
                    üí° Klik card untuk melihat detail saham. Whale terjebak = harga jauh di bawah rata-rata beli whale.
                </p>
            </div>
        </div>

        <!-- Stock Recommendations -->
        <div id="recommendationsSection" style="display: none;">
            <h2 style="text-align: center; color: #888; font-size: 1rem; margin-bottom: 20px;">
                üî• REKOMENDASI SAHAM (BUY)
            </h2>
            <div id="recommendationsList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; margin-bottom: 30px;">
            </div>
        </div>

        <!-- Stock Selector -->
        <div class="stock-selector" id="stockSelectorDiv" style="display: none;">
            <label for="stockSelect">Pilih Saham:</label>
            <select id="stockSelect" onchange="loadStock()">
                <option value="">-- Pilih Saham --</option>
            </select>
        </div>
        <!-- Dashboard Content -->
        <div id="dashboardContent" style="display: none;">
            <!-- Summary Stats -->
            <div class="stats-grid">
                <div class="stat-card whale">
                    <h3>Whale BUY</h3>
                    <div class="value" id="whaleBuy">-</div>
                    <div class="subtext" id="whaleBuyAvgDisplay">Avg: -</div>
                    <div class="subtext" id="whaleBuyPct">-</div>
                </div>
                <div class="stat-card retail">
                    <h3>Retail BUY</h3>
                    <div class="value" id="retailBuy">-</div>
                    <div class="subtext" id="retailBuyAvg">Avg: -</div>
                    <div class="subtext" id="retailBuyPct">-</div>
                </div>
                <div class="stat-card whale">
                    <h3>Whale SELL</h3>
                    <div class="value" id="whaleSell">-</div>
                    <div class="subtext" id="whaleSellAvgDisplay">Avg: -</div>
                    <div class="subtext" id="whaleSellPct">-</div>
                </div>
                <div class="stat-card retail">
                    <h3>Retail SELL</h3>
                    <div class="value" id="retailSell">-</div>
                    <div class="subtext" id="retailSellAvg">Avg: -</div>
                    <div class="subtext" id="retailSellPct">-</div>
                </div>
                <div class="stat-card whale">
                    <h3>Whale NET</h3>
                    <div class="value" id="whaleNet">-</div>
                    <div class="subtext" id="whaleNetStatus">-</div>
                </div>
                <div class="stat-card retail">
                    <h3>Retail NET</h3>
                    <div class="value" id="retailNet">-</div>
                    <div class="subtext" id="retailNetStatus">-</div>
                </div>
                <div class="stat-card whale">
                    <h3>Whale BUY AVG</h3>
                    <div class="value" id="whaleBuyAvg">-</div>
                    <div class="subtext" id="whaleBuyAvgLabel">Rata-rata harga beli</div>
                </div>
                <div class="stat-card whale">
                    <h3>Whale SELL AVG</h3>
                    <div class="value" id="whaleSellAvg">-</div>
                    <div class="subtext" id="whaleSellAvgLabel">Rata-rata harga jual</div>
                </div>
                <div class="stat-card whale">
                    <h3>Whale Kepemilikan</h3>
                    <div class="value" id="whaleOwnership">-</div>
                    <div class="subtext" id="whaleOwnershipLot">Net Lot</div>
                </div>
                <div class="stat-card whale">
                    <h3>Harga Terakhir Whale</h3>
                    <div class="value" id="whaleLastPrice">-</div>
                    <div class="subtext" id="whaleLastPriceLabel">Harga beli terakhir</div>
                </div>
                <div class="stat-card retail">
                    <h3>Retail Kepemilikan</h3>
                    <div class="value" id="retailOwnership">-</div>
                    <div class="subtext" id="retailOwnershipLot">Net Lot</div>
                </div>
            </div>
            <!-- Recommendation Panel -->
            <div class="recommendation-panel">
                <div class="recommendation-card">
                    <h3>Rekomendasi Trading</h3>
                    <div id="recommendationBadge" class="rec-badge HOLD">HOLD</div>
                    <p id="recommendationReason" class="rec-reason">Memuat rekomendasi...</p>
                    <div class="rec-signals">
                        <div class="signal-item">
                            <span class="signal-label">Signal Whale:</span>
                            <span id="whaleSignal" class="signal-value">-</span>
                        </div>
                        <div class="signal-item">
                            <span class="signal-label">Signal Retail:</span>
                            <span id="retailSignal" class="signal-value">-</span>
                        </div>
                        <div class="signal-item">
                            <span class="signal-label">Tren Harga:</span>
                            <span id="priceTrend" class="signal-value">-</span>
                        </div>
                        <div class="signal-item">
                            <span class="signal-label">Strength:</span>
                            <span id="signalStrength" class="signal-value">-</span>
                        </div>
                    </div>
                </div>
                <!-- Price Recommendation Card -->
                <div class="price-rec-card">
                    <h3>Rekomendasi Harga</h3>
                    <div class="price-grid">
                        <div class="price-item buy-zone">
                            <span class="price-label">AREA BELI</span>
                            <span class="price-label-sub">Support / Buy Zone</span>
                            <span id="buyZone" class="price-value">-</span>
                        </div>
                        <div class="price-item target">
                            <span class="price-label">TARGET</span>
                            <span class="price-label-sub">Take Profit</span>
                            <span id="targetPrice" class="price-value">-</span>
                        </div>
                        <div class="price-item sell-zone">
                            <span class="price-label">AREA JUAL</span>
                            <span class="price-label-sub">Resistance / Sell Zone</span>
                            <span id="sellZone" class="price-value">-</span>
                        </div>
                        <div class="price-item stoploss">
                            <span class="price-label">STOP LOSS</span>
                            <span class="price-label-sub">Cut Loss Point</span>
                            <span id="stopLoss" class="price-value">-</span>
                        </div>
                    </div>
                    <!-- Trapped Whale Warning -->
                    <div id="trappedWhaleWarning" class="trapped-whale-warning" style="display: none;">
                        <h4>‚ö†Ô∏è WHALE TERJEBAK</h4>
                        <p>Whale sedang <span class="highlight">underwater</span> (harga sekarang jauh di bawah rata-rata beli).</p>
                        <p style="margin-top: 8px; font-size: 0.8rem; color: #999;">Rekomendasi harga disesuaikan lebih konservatif dekat harga saat ini.</p>
                    </div>
                    <div class="price-info">
                        <p id="priceAdvice" class="price-advice-text">Memuat saran harga...</p>
                    </div>
                </div>
            </div>
            <!-- Trapped Whale Status Card -->
            <div id="trappedWhaleCard" class="trapped-whale-card" style="display: none;">
                <div class="status-header">
                    <span class="status-icon">üêã</span>
                    <span class="status-title">STATUS WHALE</span>
                    <span id="trappedBadge" class="status-badge">TERJEBAK</span>
                </div>
                <div class="status-body">
                    <div class="status-item">
                        <span class="status-label">Rata-rata Beli Whale</span>
                        <span id="trappedAvgBuy" class="status-value">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Harga Terakhir</span>
                        <span id="trappedLastPrice" class="status-value neutral">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Diskon Harga</span>
                        <span id="trappedDiscount" class="status-value">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Level Trapped</span>
                        <span id="trappedLevel" class="status-value">-</span>
                    </div>
                    <div class="status-description">
                        <strong>‚ö†Ô∏è PERINGATAN:</strong> <span id="trappedMessage">Whale sedang underwater. Rekomendasi harga disesuaikan lebih konservatif.</span>
                    </div>
                </div>
            </div>
            <!-- Insight Panel -->
            <div class="insight-panel">
                <div class="insight-card">
                    <h3>Analisis Whale</h3>
                    <p id="whaleInsight">Memuat analisis...</p>
                </div>
                <div class="insight-card">
                    <h3>Analisis Retail</h3>
                    <p id="retailInsight">Memuat analisis...</p>
                </div>
            </div>
            <!-- Charts Row 6 - Price & Flow Chart -->
            <div class="chart-section">
                <div class="chart-header-row">
                    <h2 class="stock-title" id="chartStockTitle6">BUMI - Harga Rata-rata & Cumulative Flow</h2>
                </div>
                <div class="chart-container full-width">
                    <h2>Harga Rata-rata Beli/Jual & Cumulative Net Flow (Whale + Ritel)</h2>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-color" style="background: #e74c3c;"></div>Whale Buy Avg</div>
                        <div class="legend-item"><div class="legend-color" style="background: #c0392b;"></div>Whale Sell Avg</div>
                        <div class="legend-item"><div class="legend-color" style="background: #3498db;"></div>Ritel Buy Avg</div>
                        <div class="legend-item"><div class="legend-color" style="background: #2980b9;"></div>Ritel Sell Avg</div>
                        <div class="legend-item"><div class="legend-color" style="background: #e67e22; border: 2px solid #d35400;"></div>Whale Cum Flow</div>
                        <div class="legend-item"><div class="legend-color" style="background: #27ae60; border: 2px solid #1e8449;"></div>Ritel Cum Flow</div>
                    </div>
                    <div class="chart-wrapper tall">
                        <canvas id="priceFlowChart"></canvas>
                    </div>
                    <div class="chart-description" style="border-left-color: #1abc9c;">
                        <strong>üìäüìà Kombinasi Harga & Cumulative Flow (Combo Chart)</strong><br>
                        Menampilkan harga rata-rata Whale/Ritel dengan line, dan cumulative net flow dengan area chart.<br>
                        <strong>Perhitungan Harga:</strong> <code>avg_buy = (Œ£ harga √ó volume) / Œ£ volume</code><br>
                        <strong>Perhitungan Flow:</strong> <code>cum_flow = Œ£(buy - sell) dari hari ke-1 sampai hari ini</code><br>
                        Gabungan keduanya untuk melihat korelasi harga dengan aliran dana.
                    </div>
                </div>
            </div>
            <!-- Signal Legend Panel -->
            <div class="legend-panel">
                <h2 style="color: #27ae60; font-size: 1.1rem; margin-bottom: 20px; font-weight: 600;">üìñ Panduan Signal & Legend</h2>
                <div class="legend-grid">
                    <!-- Whale Signal Legend -->
                    <div class="legend-item">
                        <div class="legend-header whale">
                            <span class="legend-icon">üêã</span>
                            <span class="legend-title">Signal Whale</span>
                        </div>
                        <div class="legend-body">
                            <div class="legend-desc">
                                <span class="signal-badge bullish">Bullish (Akumulasi)</span>
                                <span class="legend-text">Whale sedang BELI (akumulasi) ‚Üí Harga potensial NAIK</span>
                            </div>
                            <div class="legend-desc">
                                <span class="signal-badge bearish">Bearish (Distribusi)</span>
                                <span class="legend-text">Whale sedang JUAL (take profit) ‚Üí Harga potensial TURUN</span>
                            </div>
                            <div class="legend-desc">
                                <span class="signal-badge neutral">Netral (Sideways)</span>
                                <span class="legend-text">Whale tidak ada aktivitas signifikan</span>
                            </div>
                        </div>
                    </div>
                    <!-- Retail Signal Legend -->
                    <div class="legend-item">
                        <div class="legend-header retail">
                            <span class="legend-icon">üë•</span>
                            <span class="legend-title">Signal Retail (Kontrarian)</span>
                        </div>
                        <div class="legend-body">
                            <div class="legend-desc">
                                <span class="signal-badge bullish">Bullish (Kontrarian)</span>
                                <span class="legend-text">Retail panic SELL (takut) ‚Üí Saat BELI yang bagus</span>
                            </div>
                            <div class="legend-desc">
                                <span class="signal-badge bullish">Bullish (Akumulasi)</span>
                                <span class="legend-text">Retail beli moderat (1-5 M) ‚Üí Minat fishermen normal</span>
                            </div>
                            <div class="legend-desc">
                                <span class="signal-badge bearish">Bearish (Euforia = Top)</span>
                                <span class="legend-text">Retail FOMO beli BANYAK (>5 M) ‚Üí Tanda TOP, hati-hati!</span>
                            </div>
                            <div class="legend-desc">
                                <span class="signal-badge bearish">Bearish (Distribusi)</span>
                                <span class="legend-text">Retail distribusi (jual) ‚Üí Profit taking fishermen</span>
                            </div>
                            <div class="legend-desc">
                                <span class="signal-badge neutral">Netral (Sideways)</span>
                                <span class="legend-text">Retail tidak ada aktivitas signifikan</span>
                            </div>
                        </div>
                    </div>
                    <!-- Trading Logic -->
                    <div class="legend-item full-width">
                        <div class="legend-header">
                            <span class="legend-icon">üí°</span>
                            <span class="legend-title">Logika Trading (Smart Money vs Dumb Money)</span>
                        </div>
                        <div class="legend-body">
                            <div class="logic-grid">
                                <div class="logic-item">
                                    <span class="logic-phase">Fase Akumulasi</span>
                                    <span class="logic-desc">Whale BELI, Retail JUAL (takut) ‚Üí Signal <strong>BUY</strong></span>
                                </div>
                                <div class="logic-item">
                                    <span class="logic-phase">Fase Distribusi</span>
                                    <span class="logic-desc">Whale JUAL, Retail BELI (euforia) ‚Üí Signal <strong>SELL</strong></span>
                                </div>
                            </div>
                            <div class="legend-note">
                                <strong>Threshold VALUE (dalam Miliar Rupiah):</strong><br>
                                ‚Ä¢ Kuat: > 5 Miliar | ‚Ä¢ Moderat: > 1 Miliar | ‚Ä¢ Netral: ¬± 1 Miliar
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Charts Row 1 -->
            <div class="chart-section">
                <div class="chart-header-row">
                    <h2 class="stock-title" id="chartStockTitle1">BUMI - Komposisi Trading</h2>
                </div>
                <div class="chart-container">
                    <h2>Komposisi BUY</h2>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-color" style="background: #e74c3c;"></div>Whale</div>
                        <div class="legend-item"><div class="legend-color" style="background: #3498db;"></div>Ritel</div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="buyPieChart"></canvas>
                    </div>
                    <div class="chart-description" style="border-left-color: #e74c3c;">
                        <strong>üìä Komposisi BUY (Pie Chart)</strong><br>
                        Menunjukkan proporsi nilai pembelian antara <em>Whale</em> dan <em>Ritel</em>.<br>
                        <strong>Perhitungan:</strong> Total nilai BUY dalam Triliun Rupiah dari seluruh periode data.
                    </div>
                </div>
                <div class="chart-container">
                    <h2>Komposisi SELL</h2>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-color" style="background: #c0392b;"></div>Whale</div>
                        <div class="legend-item"><div class="legend-color" style="background: #2980b9;"></div>Ritel</div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="sellPieChart"></canvas>
                    </div>
                    <div class="chart-description" style="border-left-color: #c0392b;">
                        <strong>üìä Komposisi SELL (Pie Chart)</strong><br>
                        Menunjukkan proporsi nilai penjualan antara <em>Whale</em> dan <em>Ritel</em>.<br>
                        <strong>Perhitungan:</strong> Total nilai SELL dalam Triliun Rupiah dari seluruh periode data.
                    </div>
                </div>
            </div>
            <!-- Charts Row 2 -->
            <div class="chart-section">
                <div class="chart-header-row">
                    <h2 class="stock-title" id="chartStockTitle2">BUMI - Cumulative Net Flow</h2>
                </div>
                <div class="chart-container full-width">
                    <h2>Cumulative Net Flow (Akumulasi)</h2>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-color" style="background: #e74c3c;"></div>Whale</div>
                        <div class="legend-item"><div class="legend-color" style="background: #3498db;"></div>Ritel</div>
                    </div>
                    <div class="chart-wrapper tall">
                        <canvas id="cumulativeChart"></canvas>
                    </div>
                    <div class="chart-description" style="border-left-color: #27ae60;">
                        <strong>üìà Cumulative Net Flow (Line Chart)</strong><br>
                        Menunjukkan akumulasi aliran dana bersih (BUY - SELL) dari waktu ke waktu.<br>
                        <strong>Perhitungan:</strong> <code>whale_cum_net = Œ£(whale_buy_harian) - Œ£(whale_sell_harian)</code><br>
                        Nilai positif = akumulasi beli, negatif = akumulasi jual.
                    </div>
                </div>
            </div>
            <!-- Charts Row 3 -->
            <div class="chart-section">
                <div class="chart-header-row">
                    <h2 class="stock-title" id="chartStockTitle3">BUMI - Rata-rata Harga</h2>
                </div>
                <div class="chart-container full-width">
                    <h2>Rata-rata Harga Whale & Ritel per Hari</h2>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-color" style="background: #e74c3c;"></div>Whale Buy Avg</div>
                        <div class="legend-item"><div class="legend-color" style="background: #c0392b;"></div>Whale Sell Avg</div>
                        <div class="legend-item"><div class="legend-color" style="background: #3498db;"></div>Ritel Buy Avg</div>
                        <div class="legend-item"><div class="legend-color" style="background: #2980b9;"></div>Ritel Sell Avg</div>
                    </div>
                    <div class="chart-wrapper tall">
                        <canvas id="avgPriceChart"></canvas>
                    </div>
                    <div class="chart-description" style="border-left-color: #3498db;">
                        <strong>üí∞ Rata-rata Harga per Hari (Line Chart)</strong><br>
                        Menunjukkan harga rata-rata beli dan jual Whale & Ritel setiap hari.<br>
                        <strong>Perhitungan:</strong> <code>avg_whale_buy = (Œ£ harga_beli √ó nilai_beli) / Œ£ nilai_beli</code><br>
                        Harga weighted berdasarkan volume transaksi hari itu.
                    </div>
                </div>
            </div>
            <!-- Charts Row 4 -->
            <div class="chart-section">
                <div class="chart-header-row">
                    <h2 class="stock-title" id="chartStockTitle4">BUMI - Kepemilikan Saham</h2>
                </div>
                <div class="chart-container full-width">
                    <h2>Kepemilikan Saham (Net Lot) - Akumulasi</h2>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-color" style="background: #e74c3c;"></div>Whale Net Lot</div>
                        <div class="legend-item"><div class="legend-color" style="background: #3498db;"></div>Ritel Net Lot</div>
                    </div>
                    <div class="chart-wrapper tall">
                        <canvas id="ownershipChart"></canvas>
                    </div>
                    <div class="chart-description" style="border-left-color: #f39c12;">
                        <strong>üè¶ Kepemilikan Saham Net Lot (Line Chart)</strong><br>
                        Menunjukkan akumulasi kepemilikan lot bersih (BUY lot - SELL lot).<br>
                        <strong>Perhitungan:</strong> <code>whale_net_lot = Œ£(whale_buy_lot) - Œ£(whale_sell_lot)</code><br>
                        Positif = akumulasi holding, negatif = melepaskan saham.
                    </div>
                </div>
            </div>
            <!-- Charts Row 5 -->
            <div class="chart-section">
                <div class="chart-header-row">
                    <h2 class="stock-title" id="chartStockTitle5">BUMI - Top Broker</h2>
                </div>
                <div class="chart-container full-width">
                    <h2>Top 15 Brokers by Volume</h2>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-color" style="background: #27ae60;"></div>BUY</div>
                        <div class="legend-item"><div class="legend-color" style="background: #e74c3c;"></div>SELL</div>
                    </div>
                    <div class="chart-wrapper tall">
                        <canvas id="topBrokersChart"></canvas>
                    </div>
                    <div class="chart-description" style="border-left-color: #9b59b6;">
                        <strong>üèÜ Top 15 Brokers by Volume (Bar Chart)</strong><br>
                        Menunjukkan broker dengan volume transaksi terbesar (BUY + SELL).<br>
                        <strong>Perhitungan:</strong> <code>total_volume = whale_buy + whale_sell (dalam Triliun Rupiah)</code><br>
                        Diurutkan dari total transaksi terbesar.
                    </div>
                </div>
            </div>
            <!-- Broker Table -->
            <div class="broker-table">
                <div class="table-controls">
                    <h3>Daftar Broker</h3>
                    <div class="filter-group">
                        <button class="filter-btn active" onclick="filterTable('all')">Semua</button>
                        <button class="filter-btn" onclick="filterTable('whale')">Whale Only</button>
                        <button class="filter-btn" onclick="filterTable('retail')">Ritel Only</button>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Kode</th>
                            <th>Nama Broker</th>
                            <th>BUY</th>
                            <th>BUY Avg</th>
                            <th>SELL</th>
                            <th>SELL Avg</th>
                            <th>NET</th>
                            <th>Total</th>
                            <th>Kategori</th>
                        </tr>
                    </thead>
                    <tbody id="brokerTableBody">
                    </tbody>
                </table>
            </div>
        </div>
        <div style="text-align: center; padding: 30px; color: #666; margin-top: 30px; border-top: 1px solid rgba(255,255,255,0.1);">
            <p>üêã Lamalera</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">Whale Trading Analysis Dashboard</p>
        </div>
    </div>
    <script>
        let allData = null;
        let currentStock = null;
        let buyPieChart = null;
        let sellPieChart = null;
        let cumulativeChart = null;
        let avgPriceChart = null;
        let ownershipChart = null;
        let topBrokersChart = null;
        let priceFlowChart = null;

        // ===== DATA LOADING =====
        async function loadData() {
            try {
                const response = await fetch('broker_data.json');
                if (!response.ok) {
                    throw new Error('File tidak ditemukan');
                }
                allData = await response.json();
                showError('');
                document.getElementById('loadingMessage').style.display = 'none';
                populateStockSelect();
            } catch (error) {
                // Fetch failed, show fallback option
                document.getElementById('loadingText').textContent = 'Auto-load gagal (CORS restriction). Gunakan salah satu cara di bawah:';
            }
        }

        function loadFromFile(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        allData = JSON.parse(e.target.result);
                        showError('');
                        document.getElementById('loadingMessage').style.display = 'none';
                        populateStockSelect();
                    } catch (error) {
                        showError('Error parsing JSON: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            if (message) {
                errorEl.textContent = message;
                errorEl.style.display = 'block';
            } else {
                errorEl.style.display = 'none';
            }
        }

        // ===== DISPLAY FUNCTIONS (Read from JSON) =====

        /**
         * Update summary statistics from JSON
         */
        function updateSummary() {
            const s = currentStock.summary;
            const totalBuy = s.total_buy;
            const totalSell = s.total_sell;

            document.getElementById('whaleBuy').textContent = `Rp ${s.whale_buy} T`;
            document.getElementById('whaleBuyAvgDisplay').textContent = `Avg: Rp ${s.whale_buyavg}`;
            document.getElementById('whaleBuyPct').textContent = `${((s.whale_buy / totalBuy) * 100).toFixed(0)}% dari total`;

            document.getElementById('retailBuy').textContent = `Rp ${s.retail_buy} T`;
            document.getElementById('retailBuyAvg').textContent = `Avg: Rp ${s.retail_buyavg}`;
            document.getElementById('retailBuyPct').textContent = `${((s.retail_buy / totalBuy) * 100).toFixed(0)}% dari total`;

            document.getElementById('whaleSell').textContent = `Rp ${s.whale_sell} T`;
            document.getElementById('whaleSellAvgDisplay').textContent = `Avg: Rp ${s.whale_sellavg}`;
            document.getElementById('whaleSellPct').textContent = `${((s.whale_sell / totalSell) * 100).toFixed(0)}% dari total`;

            document.getElementById('retailSell').textContent = `Rp ${s.retail_sell} T`;
            document.getElementById('retailSellAvg').textContent = `Avg: Rp ${s.retail_sellavg}`;
            document.getElementById('retailSellPct').textContent = `${((s.retail_sell / totalSell) * 100).toFixed(0)}% dari total`;

            // Whale BUY Avg Card
            const whaleBuyAvgEl = document.getElementById('whaleBuyAvg');
            whaleBuyAvgEl.textContent = `Rp ${s.whale_buyavg}`;
            const whaleBuyAvgLabelEl = document.getElementById('whaleBuyAvgLabel');
            whaleBuyAvgLabelEl.textContent = 'Rata-rata harga beli';

            // Whale SELL Avg Card
            const whaleSellAvgEl = document.getElementById('whaleSellAvg');
            whaleSellAvgEl.textContent = `Rp ${s.whale_sellavg}`;
            const whaleSellAvgLabelEl = document.getElementById('whaleSellAvgLabel');
            whaleSellAvgLabelEl.textContent = 'Rata-rata harga jual';

            const whaleNetEl = document.getElementById('whaleNet');
            whaleNetEl.textContent = `${s.whale_net >= 0 ? '+' : ''}Rp ${Math.abs(s.whale_net)} M`;
            whaleNetEl.className = 'value ' + (s.whale_net >= 0 ? 'positive' : 'negative');
            document.getElementById('whaleNetStatus').textContent = s.whale_net >= 0 ? 'AKUMULASI/BELI' : 'DISTRIBUSI/JUAL';

            const fishermenNetEl = document.getElementById('retailNet');
            fishermenNetEl.textContent = `${s.retail_net >= 0 ? '+' : ''}Rp ${Math.abs(s.retail_net)} M`;
            fishermenNetEl.className = 'value ' + (s.retail_net >= 0 ? 'positive' : 'negative');
            document.getElementById('retailNetStatus').textContent = s.retail_net >= 0 ? 'AKUMULASI/BELI' : 'DISTRIBUSI/JUAL';

            const whaleOwnEl = document.getElementById('whaleOwnership');
            whaleOwnEl.textContent = `${(s.whale_net >= 0 ? '+' : '')}Rp ${Math.abs(s.whale_net).toFixed(1)} M`;
            whaleOwnEl.className = 'value ' + (s.whale_net >= 0 ? 'positive' : 'negative');
            document.getElementById('whaleOwnershipLot').textContent = `${(s.whale_net >= 0 ? '+' : '')}Rp ${Math.abs(s.whale_net).toFixed(1)} Miliar`;

            const retailOwnEl = document.getElementById('retailOwnership');
            retailOwnEl.textContent = `${(s.retail_net >= 0 ? '+' : '')}Rp ${Math.abs(s.retail_net).toFixed(1)} M`;
            retailOwnEl.className = 'value ' + (s.retail_net >= 0 ? 'positive' : 'negative');
            document.getElementById('retailOwnershipLot').textContent = `${(s.retail_net >= 0 ? '+' : '')}Rp ${Math.abs(s.retail_net).toFixed(1)} Miliar`;

            // Harga Terakhir Shark Card
            const lastWhaleBuyPrice = currentStock.volatilityTrend?.lastWhaleBuyPrice || 0;
            const whaleLastPriceEl = document.getElementById('whaleLastPrice');
            if (lastWhaleBuyPrice > 0) {
                whaleLastPriceEl.textContent = `Rp ${lastWhaleBuyPrice}`;
                whaleLastPriceEl.className = 'value positive';
            } else {
                whaleLastPriceEl.textContent = '-';
                whaleLastPriceEl.className = 'value';
            }
            document.getElementById('whaleLastPriceLabel').textContent = 'Harga beli terakhir';
        }

        /**
         * Update signals and recommendation from JSON
         */
        function updateSignals() {
            const rec = currentStock.recommendation;

            // Update recommendation badge
            const badge = document.getElementById('recommendationBadge');
            badge.textContent = rec.recommendation;
            badge.className = 'rec-badge ' + rec.recommendation;

            // Update recommendation reason
            let reason = rec.signals.join('. ');
            document.getElementById('recommendationReason').textContent = reason;

            // Update whale signal
            const whaleSignalEl = document.getElementById('whaleSignal');
            whaleSignalEl.textContent = rec.whaleSignal === 'bullish' ? 'Bullish (Akumulasi)' :
                                       rec.whaleSignal === 'bearish' ? 'Bearish (Distribusi)' : 'Netral';
            whaleSignalEl.className = 'signal-value ' + rec.whaleSignal;

            // Update retail signal
            const retailSignalEl = document.getElementById('retailSignal');
            if (rec.retailSignal === 'bullish') {
                if (rec.retailBullishReason === 'kontrarian') {
                    retailSignalEl.textContent = 'Bullish (Kontrarian)';
                } else if (rec.retailBullishReason === 'akumulasi') {
                    retailSignalEl.textContent = 'Bullish (Akumulasi)';
                } else {
                    retailSignalEl.textContent = 'Bullish';
                }
            } else if (rec.retailSignal === 'bearish') {
                if (rec.retailBearishReason === 'euforia') {
                    retailSignalEl.textContent = 'Bearish (Euforia = Top)';
                } else if (rec.retailBearishReason === 'distribusi') {
                    retailSignalEl.textContent = 'Bearish (Distribusi)';
                } else {
                    retailSignalEl.textContent = 'Bearish';
                }
            } else if (rec.retailSignal === 'neutral') {
                retailSignalEl.textContent = 'Netral (Sideways)';
            } else {
                retailSignalEl.textContent = 'Netral';
            }
            retailSignalEl.className = 'signal-value ' + rec.retailSignal;

            // Update price trend
            const priceTrendEl = document.getElementById('priceTrend');
            priceTrendEl.textContent = rec.priceTrend === 'up' ? 'Naik ‚Üë' :
                                       rec.priceTrend === 'down' ? 'Turun ‚Üì' : 'Netral ‚Üí';
            priceTrendEl.className = 'signal-value ' + (rec.priceTrend === 'up' ? 'bullish' : rec.priceTrend === 'down' ? 'bearish' : 'neutral');

            // Update strength
            const strengthEl = document.getElementById('signalStrength');
            strengthEl.textContent = rec.strength === 'strong' ? 'Kuat' :
                                     rec.strength === 'moderate' ? 'Sedang' : 'Lemah';
            strengthEl.className = 'signal-value ' + (rec.strength === 'strong' ? 'bullish' : rec.strength === 'moderate' ? 'neutral' : 'bearish');
        }

        /**
         * Update price recommendations from JSON
         */
        function updatePrices() {
            const pr = currentStock.priceRecommendation;

            document.getElementById('buyZone').innerHTML = `Rp ${pr.buyZone}<sup style="font-size:0.7em; color:#888;">tick:${pr.buyTick}</sup>`;
            document.getElementById('targetPrice').innerHTML = `Rp ${pr.targetPrice}<sup style="font-size:0.7em; color:#888;">tick:${pr.targetTick}</sup>`;
            document.getElementById('sellZone').innerHTML = `Rp ${pr.sellZone}<sup style="font-size:0.7em; color:#888;">tick:${pr.sellTick}</sup>`;
            document.getElementById('stopLoss').innerHTML = `Rp ${pr.stopLoss}<sup style="font-size:0.7em; color:#888;">tick:${pr.stopTick}</sup>`;

            // Trapped Whale Warning
            const trappedWarning = document.getElementById('trappedWhaleWarning');
            const trappedCard = document.getElementById('trappedWhaleCard');
            const trappedBadge = document.getElementById('trappedBadge');
            const trappedAvgBuy = document.getElementById('trappedAvgBuy');
            const trappedLastPrice = document.getElementById('trappedLastPrice');
            const trappedDiscount = document.getElementById('trappedDiscount');
            const trappedLevel = document.getElementById('trappedLevel');
            const trappedMessage = document.getElementById('trappedMessage');

            if (pr.isWhaleTrapped) {
                trappedWarning.style.display = 'block';
                trappedCard.style.display = 'block';

                const trapLevel = pr.whaleTrapLevel || 'unknown';
                const levelText = trapLevel === 'severe' ? 'BERAT' : trapLevel === 'mild' ? 'RINGAN' : 'UNKNOWN';
                const discount = ((pr.avgWhaleBuy - pr.lastPrice) / pr.avgWhaleBuy * 100).toFixed(0);

                trappedWarning.querySelector('h4').innerHTML =
                    `‚ö†Ô∏è WHALE TERJEBAK ${levelText}`;
                trappedWarning.querySelector('p').innerHTML =
                    `Whale beli rata-rata <span class="highlight">Rp ${pr.avgWhaleBuy}</span> tapi harga sekarang <span class="highlight">Rp ${pr.lastPrice}</span> (-${discount}%).`;

                // Update trapped whale card
                trappedBadge.textContent = `TERJEBAK ${levelText}`;
                trappedAvgBuy.textContent = `Rp ${pr.avgWhaleBuy}`;
                trappedLastPrice.textContent = `Rp ${pr.lastPrice}`;
                trappedDiscount.textContent = `-${discount}%`;
                trappedLevel.textContent = levelText;

                if (trapLevel === 'severe') {
                    trappedMessage.innerHTML = `<strong>Whale terjebak berat (-${discount}% dari rata-rata beli).</strong> Harga masuk area beli tapi belum ada tanda reversal. Disarankan <strong>HOLD</strong> sampai ada sinyal konfirmasi.`;
                } else {
                    trappedMessage.innerHTML = `<strong>Whale terjebak ringan (-${discount}%).</strong> Potensi oversold, tapi tunggu sinyal konfirmasi sebelum entry.`;
                }
            } else {
                trappedWarning.style.display = 'none';
                trappedCard.style.display = 'none';
            }

            // Update price advice
            const rec = currentStock.recommendation;
            let priceAdvice = '';

            if (rec.recommendation === 'BUY') {
                priceAdvice = `üí° <strong>STRATEGI ENTRY</strong>:<br>`;
                priceAdvice += `‚Ä¢ <strong>Buy Zone:</strong> Rp ${pr.buyZone}<br>`;
                priceAdvice += `‚Ä¢ <strong>Target:</strong> Rp ${pr.targetPrice} (potensi +${pr.potentialProfit}%)<br>`;
                priceAdvice += `‚Ä¢ <strong>Stop Loss:</strong> Rp ${pr.stopLoss} (risiko -${pr.potentialLoss}%)<br>`;
                priceAdvice += `‚Ä¢ <strong>R:RR:</strong> ${pr.displayRR}:1 ${pr.rrRatio >= 2.5 ? '‚úÖ Excellent' : pr.rrRatio >= 2 ? '‚úÖ Baik' : pr.rrRatio >= 1.5 ? '‚ö†Ô∏è Moderat' : '‚ùå Kurang'}`;
            } else if (rec.recommendation === 'SELL') {
                priceAdvice = `üí° <strong>STRATEGI EXIT</strong>:<br>`;
                priceAdvice += `‚Ä¢ <strong>Sell Zone:</strong> Rp ${pr.sellZone}<br>`;
                priceAdvice += `‚Ä¢ <strong>Target Exit:</strong> Rp ${pr.targetPrice}<br>`;
                priceAdvice += `‚Ä¢ <strong>Stop Loss:</strong> Rp ${pr.stopLoss} (jika masih hold)`;
            } else {
                priceAdvice = `‚è∏Ô∏è <strong>STRATEGI WAIT</strong>:<br>`;
                priceAdvice += `‚Ä¢ Signal campuran, tidak ada konfirmasi jelas<br>`;
                priceAdvice += `‚Ä¢ <strong>Buy jika:</strong> Harga turun ke Rp ${pr.buyZone}<br>`;
                priceAdvice += `‚Ä¢ <strong>Sell jika:</strong> Harga break resistance Rp ${pr.sellZone}`;
            }

            document.getElementById('priceAdvice').innerHTML = priceAdvice;
        }

        /**
         * Update confidence display from JSON
         */
        function updateConfidence() {
            const conf = currentStock.confidence;
            const badge = document.getElementById('recommendationBadge');

            // Update badge shadow based on confidence level
            if (conf.confidenceLevel === 'TINGGI') {
                badge.style.boxShadow = '0 4px 20px rgba(39, 174, 96, 0.5)';
            } else if (conf.confidenceLevel === 'RENDAH') {
                badge.style.boxShadow = '0 4px 15px rgba(231, 76, 60, 0.3)';
            } else {
                badge.style.boxShadow = '0 4px 15px rgba(243, 156, 18, 0.3)';
            }
        }

        /**
         * Update insights from JSON
         */
        function updateInsights() {
            const insights = currentStock.insights;
            const days = currentStock.daily.length;

            document.getElementById('whaleInsight').innerHTML = insights.whaleInsight;
            document.getElementById('retailInsight').innerHTML = insights.retailInsight;
        }

        // ===== STOCK SELECT & RECOMMENDATIONS =====

        function renderTrappedWhaleList() {
            const container = document.getElementById('trappedWhaleList');
            const section = document.getElementById('trappedWhaleAlertSection');
            const countBadge = document.getElementById('trappedCount');

            // Get stocks with trapped whale
            const trappedStocks = Object.entries(allData.stocks)
                .filter(([code, stock]) => stock.priceRecommendation?.isWhaleTrapped)
                .map(([code, stock]) => {
                    const pr = stock.priceRecommendation;
                    const discount = ((pr.avgWhaleBuy - pr.lastPrice) / pr.avgWhaleBuy * 100).toFixed(0);
                    return {
                        code: code,
                        trapLevel: pr.whaleTrapLevel,
                        avgBuy: pr.avgWhaleBuy,
                        lastPrice: pr.lastPrice,
                        discount: discount,
                        rec: stock.recommendation.recommendation
                    };
                })
                .sort((a, b) => parseFloat(b.discount) - parseFloat(a.discount));

            if (trappedStocks.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            countBadge.textContent = `${trappedStocks.length} saham`;

            container.innerHTML = trappedStocks.map(stock => {
                const isSevere = stock.trapLevel === 'severe';
                const severityClass = isSevere ? 'severe' : 'mild';

                return `
                    <div class="trapped-alert-card ${severityClass}" onclick="selectStockFromRec('${stock.code}')">
                        <div class="card-header">
                            <span class="stock-code ${severityClass}">${stock.code}</span>
                            <span class="trap-badge ${severityClass}">${stock.trapLevel}</span>
                        </div>
                        <div class="card-body">
                            <div class="info-item">
                                <span class="info-label">Avg Beli</span>
                                <span class="info-value ${severityClass}">Rp ${stock.avgBuy}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Harga Last</span>
                                <span class="info-value ${severityClass}">Rp ${stock.lastPrice}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Diskon</span>
                                <span class="info-arrow">‚Üì ${stock.discount}%</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Rekomendasi</span>
                                <span class="info-value ${severityClass}">${stock.rec}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderRecommendations() {
            const container = document.getElementById('recommendationsList');
            const section = document.getElementById('recommendationsSection');

            // Get stocks with BUY recommendation from JSON
            const buyRecommendations = Object.entries(allData.stocks)
                .filter(([code, stock]) => stock.recommendation.recommendation === 'BUY')
                .map(([code, stock]) => ({
                    code: code,
                    rec: stock.recommendation,
                    summary: stock.summary
                }))
                .sort((a, b) => b.rec.score - a.rec.score)
                .slice(0, 6);

            if (buyRecommendations.length === 0) {
                section.style.display = 'none';
                return;
            }

            container.innerHTML = buyRecommendations.map(item => {
                const rec = item.rec;
                const strengthClass = rec.strength === 'strong' ? 'strong' : 'moderate';
                const conf = currentStock?.confidence || {confidenceLevel: 'medium'};
                const confidenceLevel = rec.score >= 3 ? 'high' : rec.score >= 1.5 ? 'medium' : 'low';
                const confidenceText = confidenceLevel === 'high' ? 'TINGGI' : confidenceLevel === 'medium' ? 'SEDANG' : 'RENDAH';

                return `
                    <div class="stock-rec-card" onclick="selectStockFromRec('${item.code}')">
                        <div class="stock-rec-confidence ${confidenceLevel}">${confidenceText}</div>
                        <div class="stock-rec-header">
                            <div class="stock-rec-code">${item.code}</div>
                            <div class="stock-rec-badge ${strengthClass}">${rec.recommendation}</div>
                        </div>
                        <div class="stock-rec-info">
                            <div class="stock-rec-info-item">
                                <div class="stock-rec-info-label">Whale NET</div>
                                <div class="stock-rec-info-value ${item.summary.whale_net >= 0 ? 'positive' : 'negative'}">
                                    ${item.summary.whale_net >= 0 ? '+' : ''}${item.summary.whale_net.toFixed(1)} M
                                </div>
                            </div>
                            <div class="stock-rec-info-item">
                                <div class="stock-rec-info-label">Trend</div>
                                <div class="stock-rec-info-value">
                                    ${rec.priceTrend === 'up' ? 'üìà Naik' : rec.priceTrend === 'down' ? 'üìâ Turun' : '‚û°Ô∏è Sideways'}
                                </div>
                            </div>
                        </div>
                        <div class="stock-rec-reason">
                            ${rec.strength === 'strong' ? 'üî• Signal Kuat' : 'üìä Signal Moderat'} |
                            Whale ${rec.whaleSignal === 'bullish' ? 'akumulasi' : rec.whaleSignal === 'bearish' ? 'distribusi' : 'netral'}
                        </div>
                    </div>
                `;
            }).join('');

            section.style.display = 'block';
        }

        function selectStockFromRec(stockCode) {
            const select = document.getElementById('stockSelect');
            select.value = stockCode;
            loadStock();
            document.getElementById('dashboardContent').scrollIntoView({ behavior: 'smooth' });
        }

        function populateStockSelect() {
            const select = document.getElementById('stockSelect');
            select.innerHTML = '<option value="">-- Pilih Saham --</option>';
            const stocks = Object.keys(allData.stocks).sort();
            stocks.forEach(code => {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = code;
                select.appendChild(option);
            });
            document.getElementById('stockSelectorDiv').style.display = 'flex';

            // Render trapped whale list
            renderTrappedWhaleList();

            // Render recommendation cards
            renderRecommendations();

            // Auto-select first BUY recommendation or first stock
            const buyRecs = Object.entries(allData.stocks)
                .filter(([code, stock]) => stock.recommendation.recommendation === 'BUY')
                .sort((a, b) => b[1].recommendation.score - a[1].recommendation.score);

            if (buyRecs.length > 0) {
                select.value = buyRecs[0][0];
                loadStock();
            } else if (stocks.length > 0) {
                select.value = stocks[0];
                loadStock();
            }
        }

        function loadStock() {
            const stockCode = document.getElementById('stockSelect').value;
            if (!stockCode || !allData.stocks[stockCode]) {
                return;
            }

            currentStock = allData.stocks[stockCode];
            document.getElementById('dashboardContent').style.display = 'block';

            // Update period info
            const periodInfo = document.getElementById('periodInfo');
            const periodText = document.getElementById('periodText');
            periodInfo.style.display = 'block';
            periodText.textContent = `${currentStock.date_start} s/d ${currentStock.date_end} (${currentStock.daily.length} hari trading)`;

            // Update chart stock titles
            document.getElementById('chartStockTitle1').textContent = `${stockCode} - Komposisi Trading`;
            document.getElementById('chartStockTitle2').textContent = `${stockCode} - Cumulative Net Flow`;
            document.getElementById('chartStockTitle3').textContent = `${stockCode} - Rata-rata Harga`;
            document.getElementById('chartStockTitle4').textContent = `${stockCode} - Kepemilikan Saham`;
            document.getElementById('chartStockTitle5').textContent = `${stockCode} - Top Broker`;
            document.getElementById('chartStockTitle6').textContent = `${stockCode} - Harga & Net Flow`;

            // Update all display elements
            updateSummary();
            updateSignals();
            updatePrices();
            updateConfidence();
            updateInsights();

            // Create charts
            createCharts();

            // Populate table
            populateTable();
        }

        // ===== CHARTS =====
        function createCharts() {
            destroyCharts();
            const daily = currentStock.daily;
            const labels = daily.map(d => d.date_display || `Hari ${d.day}`);

            // Buy Pie Chart
            const buyCtx = document.getElementById('buyPieChart').getContext('2d');
            buyPieChart = new Chart(buyCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Whale', 'Ritel'],
                    datasets: [{
                        data: [currentStock.summary.whale_buy, currentStock.summary.retail_buy],
                        backgroundColor: ['#e74c3c', '#3498db'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: ctx => `${ctx.label}: Rp ${ctx.raw} Triliun`
                            }
                        }
                    }
                }
            });

            // Sell Pie Chart
            const sellCtx = document.getElementById('sellPieChart').getContext('2d');
            sellPieChart = new Chart(sellCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Whale', 'Ritel'],
                    datasets: [{
                        data: [currentStock.summary.whale_sell, currentStock.summary.retail_sell],
                        backgroundColor: ['#c0392b', '#2980b9'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: ctx => `${ctx.label}: Rp ${ctx.raw} Triliun`
                            }
                        }
                    }
                }
            });

            // Cumulative Chart
            const cumCtx = document.getElementById('cumulativeChart').getContext('2d');
            cumulativeChart = new Chart(cumCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Whale Cumulative',
                            data: daily.map(d => d.whale_cum_net),
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 2
                        },
                        {
                            label: 'Ritel Cumulative',
                            data: daily.map(d => d.retail_cum_net),
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { grid: { color: 'rgba(255,255,255,0.05)', drawBorder: false }, ticks: { color: '#888', maxTicksLimit: 10 } },
                        y: { grid: { color: 'rgba(255,255,255,0.05)', drawBorder: false }, ticks: { color: '#888', callback: v => `${v >= 0 ? '+' : ''}${v} M` } }
                    },
                    plugins: {
                        legend: { display: true, labels: { color: '#888' }, position: 'top' }
                    }
                }
            });

            // Average Price Chart
            const avgCtx = document.getElementById('avgPriceChart').getContext('2d');
            avgPriceChart = new Chart(avgCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Whale Buy Avg',
                            data: daily.map(d => d.whale_buyavg || 0),
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            fill: false,
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 3
                        },
                        {
                            label: 'Whale Sell Avg',
                            data: daily.map(d => d.whale_sellavg || 0),
                            borderColor: '#c0392b',
                            backgroundColor: 'rgba(192, 57, 43, 0.1)',
                            fill: false,
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 3
                        },
                        {
                            label: 'Ritel Buy Avg',
                            data: daily.map(d => d.retail_buyavg || 0),
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            fill: false,
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 3
                        },
                        {
                            label: 'Ritel Sell Avg',
                            data: daily.map(d => d.retail_sellavg || 0),
                            borderColor: '#2980b9',
                            backgroundColor: 'rgba(41, 128, 185, 0.1)',
                            fill: false,
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { grid: { color: 'rgba(255,255,255,0.05)', drawBorder: false }, ticks: { color: '#888', maxTicksLimit: 10 } },
                        y: { grid: { color: 'rgba(255,255,255,0.05)', drawBorder: false }, ticks: { color: '#888', callback: v => 'Rp ' + v.toFixed(0) } }
                    },
                    plugins: {
                        legend: { display: true, labels: { color: '#888' }, position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: ctx => `${ctx.dataset.label}: Rp ${ctx.raw.toFixed(2)}`
                            }
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    }
                }
            });

            // Ownership Chart
            const ownCtx = document.getElementById('ownershipChart').getContext('2d');
            ownershipChart = new Chart(ownCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Whale Net Lot',
                            data: daily.map(d => d.whale_net_lot || 0),
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 2
                        },
                        {
                            label: 'Ritel Net Lot',
                            data: daily.map(d => d.retail_net_lot || 0),
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { grid: { color: 'rgba(255,255,255,0.05)', drawBorder: false }, ticks: { color: '#888', maxTicksLimit: 10 } },
                        y: { grid: { color: 'rgba(255,255,255,0.05)', drawBorder: false }, ticks: { color: '#888', callback: v => v.toLocaleString('id-ID') + ' lot' } }
                    },
                    plugins: {
                        legend: { display: true, labels: { color: '#888' }, position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: ctx => `${ctx.dataset.label}: ${ctx.raw.toLocaleString('id-ID')} lot (${(ctx.raw * 100).toLocaleString('id-ID')} saham)`
                            }
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    }
                }
            });

            // Top Brokers Chart
            const brokers = currentStock.brokers.slice(0, 15);
            const topCtx = document.getElementById('topBrokersChart').getContext('2d');
            topBrokersChart = new Chart(topCtx, {
                type: 'bar',
                data: {
                    labels: brokers.map(b => b.code),
                    datasets: [
                        {
                            label: 'BUY',
                            data: brokers.map(b => b.buy),
                            backgroundColor: '#27ae60'
                        },
                        {
                            label: 'SELL',
                            data: brokers.map(b => b.sell),
                            backgroundColor: '#e74c3c'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { stacked: true, grid: { display: false }, ticks: { color: '#888' } },
                        y: { stacked: true, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#888' } }
                    },
                    plugins: {
                        legend: { display: true, labels: { color: '#888' }, position: 'top' }
                    }
                }
            });

            // Price & Flow Chart
            const pfCtx = document.getElementById('priceFlowChart').getContext('2d');
            let whaleCumFlow = 0;
            let retailCumFlow = 0;
            const whaleCumulativeFlow = daily.map(d => {
                whaleCumFlow += (d.whale_net || 0);
                return whaleCumFlow;
            });
            const retailCumulativeFlow = daily.map(d => {
                retailCumFlow += (d.retail_net || 0);
                return retailCumFlow;
            });

            priceFlowChart = new Chart(pfCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Whale Buy Avg',
                            data: daily.map(d => d.whale_buyavg || 0),
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.05)',
                            fill: false,
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 3,
                            pointBackgroundColor: '#e74c3c',
                            yAxisID: 'y'
                        },
                        {
                            label: 'Whale Sell Avg',
                            data: daily.map(d => d.whale_sellavg || 0),
                            borderColor: '#c0392b',
                            backgroundColor: 'rgba(192, 57, 43, 0.05)',
                            fill: false,
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 3,
                            pointBackgroundColor: '#c0392b',
                            yAxisID: 'y'
                        },
                        {
                            label: 'Ritel Buy Avg',
                            data: daily.map(d => d.retail_buyavg || 0),
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.05)',
                            fill: false,
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 3,
                            pointBackgroundColor: '#3498db',
                            yAxisID: 'y'
                        },
                        {
                            label: 'Ritel Sell Avg',
                            data: daily.map(d => d.retail_sellavg || 0),
                            borderColor: '#2980b9',
                            backgroundColor: 'rgba(41, 128, 185, 0.05)',
                            fill: false,
                            tension: 0.4,
                            borderWidth: 2,
                            pointRadius: 3,
                            pointBackgroundColor: '#2980b9',
                            yAxisID: 'y'
                        },
                        {
                            label: 'Whale Cum Flow',
                            data: whaleCumulativeFlow,
                            borderColor: '#e67e22',
                            backgroundColor: 'rgba(230, 126, 34, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3,
                            pointRadius: 2,
                            pointBackgroundColor: '#e67e22',
                            yAxisID: 'y1'
                        },
                        {
                            label: 'Ritel Cum Flow',
                            data: retailCumulativeFlow,
                            borderColor: '#27ae60',
                            backgroundColor: 'rgba(39, 174, 96, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3,
                            pointRadius: 2,
                            pointBackgroundColor: '#27ae60',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255,255,255,0.05)', drawBorder: false },
                            ticks: { color: '#888', maxTicksLimit: 10 }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            grid: { color: 'rgba(255,255,255,0.05)', drawBorder: false },
                            ticks: { color: '#888', callback: v => 'Rp ' + v.toFixed(0) },
                            title: { display: true, text: 'Harga Rata-rata', color: '#888' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: { drawOnChartArea: false },
                            ticks: { color: '#27ae60', callback: v => (v >= 0 ? '+' : '') + v.toFixed(1) + ' M' },
                            title: { display: true, text: 'Cumulative Net Flow', color: '#27ae60' }
                        }
                    },
                    plugins: {
                        legend: { display: true, labels: { color: '#888', boxWidth: 15, padding: 15 }, position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(ctx) {
                                    const idx = ctx.datasetIndex;
                                    const raw = ctx.raw;
                                    if (idx === 0) return `Whale Buy Avg: Rp ${raw.toFixed(2)}`;
                                    if (idx === 1) return `Whale Sell Avg: Rp ${raw.toFixed(2)}`;
                                    if (idx === 2) return `Ritel Buy Avg: Rp ${raw.toFixed(2)}`;
                                    if (idx === 3) return `Ritel Sell Avg: Rp ${raw.toFixed(2)}`;
                                    if (idx === 4) return `Whale Cum Flow: ${(raw >= 0 ? '+' : '')}${raw.toFixed(2)} Miliar`;
                                    if (idx === 5) return `Ritel Cum Flow: ${(raw >= 0 ? '+' : '')}${raw.toFixed(2)} Miliar`;
                                    return '';
                                }
                            }
                        }
                    }
                }
            });
        }

        function destroyCharts() {
            if (buyPieChart) { buyPieChart.destroy(); buyPieChart = null; }
            if (sellPieChart) { sellPieChart.destroy(); sellPieChart = null; }
            if (cumulativeChart) { cumulativeChart.destroy(); cumulativeChart = null; }
            if (avgPriceChart) { avgPriceChart.destroy(); avgPriceChart = null; }
            if (ownershipChart) { ownershipChart.destroy(); ownershipChart = null; }
            if (topBrokersChart) { topBrokersChart.destroy(); topBrokersChart = null; }
            if (priceFlowChart) { priceFlowChart.destroy(); priceFlowChart = null; }
        }

        // ===== BROKER TABLE =====
        function populateTable(filter = 'all') {
            const tbody = document.getElementById('brokerTableBody');
            tbody.innerHTML = '';
            let brokers = currentStock.brokers;
            if (filter === 'whale') {
                brokers = brokers.filter(b => b.category === 'whale');
            } else if (filter === 'retail') {
                brokers = brokers.filter(b => b.category === 'retail');
            }
            brokers.forEach((b, i) => {
                const row = document.createElement('tr');
                const netClass = b.net >= 0 ? 'positive' : 'negative';
                row.innerHTML = `
                    <td>${i + 1}</td>
                    <td><strong>${b.code}</strong></td>
                    <td style="text-align:left;">${b.name}</td>
                    <td style="color:#27ae60;">Rp ${b.buy.toFixed(2)} M</td>
                    <td style="color:#888;">${b.buyavg > 0 ? 'Rp ' + b.buyavg.toFixed(2) : '-'}</td>
                    <td style="color:#e74c3c;">Rp ${b.sell.toFixed(2)} M</td>
                    <td style="color:#888;">${b.sellavg > 0 ? 'Rp ' + b.sellavg.toFixed(2) : '-'}</td>
                    <td style="color:${b.net >= 0 ? '#27ae60' : '#e74c3c'};" class="${netClass}">
                        ${b.net >= 0 ? '+' : ''}Rp ${b.net.toFixed(2)} M
                    </td>
                    <td style="color:#888;">Rp ${b.total.toFixed(2)} M</td>
                    <td><span class="badge ${b.category}">${b.category === 'whale' ? 'WHALE' : 'RITEL'}</span></td>
                `;
                tbody.appendChild(row);
            });
            // Add date row at end of table
            const dateRow = document.createElement('tr');
            dateRow.style.background = 'rgba(255,255,255,0.05)';
            dateRow.innerHTML = `
                <td colspan="10" style="padding: 15px; text-align: left; color: #888;">
                    <strong>Periode Data:</strong> ${currentStock.date_start} s/d ${currentStock.date_end} | Total: ${currentStock.daily.length} hari trading
                </td>
            `;
            tbody.appendChild(dateRow);
        }

        function filterTable(filter) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            populateTable(filter);
        }

        // ===== RESPONSIVE CHART HANDLING =====
        let resizeTimeout;
        function handleResize() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                // Resize all active charts
                const charts = [buyPieChart, sellPieChart, cumulativeChart, avgPriceChart, ownershipChart, topBrokersChart, priceFlowChart];
                charts.forEach(chart => {
                    if (chart) {
                        chart.resize();
                    }
                });
            }, 250);
        }

        // Handle orientation change for mobile
        function handleOrientationChange() {
            setTimeout(() => {
                handleResize();
                // Adjust chart heights for portrait/landscape
                const isPortrait = window.innerHeight > window.innerWidth;
                const chartWrappers = document.querySelectorAll('.chart-wrapper');
                chartWrappers.forEach(wrapper => {
                    if (isPortrait) {
                        wrapper.style.height = wrapper.classList.contains('tall') ? '280px' : '220px';
                    } else {
                        wrapper.style.height = wrapper.classList.contains('tall') ? '350px' : '280px';
                    }
                });
            }, 100);
        }

        // Event listeners for responsive behavior
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleOrientationChange);

        // Detect viewport height changes (mobile browser toolbar)
        let initialViewportHeight = window.innerHeight;
        window.addEventListener('resize', () => {
            const currentViewportHeight = window.innerHeight;
            if (Math.abs(currentViewportHeight - initialViewportHeight) > 100) {
                initialViewportHeight = currentViewportHeight;
                document.documentElement.style.setProperty('--vh', `${currentViewportHeight * 0.01}px`);
            }
        });

        // Initialize CSS variable for mobile viewport height
        document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`);

        // Auto-load data on page load
        window.onload = function() {
            loadData();
        };
    </script>
</body>
</html>
